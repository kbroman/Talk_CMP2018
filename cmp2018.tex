\documentclass[12pt,t]{beamer}
\usepackage{graphicx}
\setbeameroption{hide notes}
\setbeamertemplate{note page}[plain]
\usepackage{listings}

\input{header.tex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% end of header
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% title info
\title{Steps toward reproducible research}
\author{\href{https://kbroman.org}{Karl Broman}}
\institute{Biostatistics \& Medical Informatics \\ Univ.\ Wisconsin{\textendash}Madison}
\date{\href{https://kbroman.org}{\tt \scriptsize \color{foreground} kbroman.org}
\\[-4pt]
\href{https://twitter.com/kwbroman}{\tt \scriptsize \color{foreground} @kwbroman}
\\[2pt]
\scriptsize {\lolit Slides:} \href{https://bit.ly/cmp2018}{\tt \scriptsize
  \color{foreground} bit.ly/cmp2018}
}


\begin{document}

% title slide
{
\setbeamertemplate{footline}{} % no page number here
\frame{
  \titlepage

  \vfill \hfill \includegraphics[height=6mm]{Figs/cc-zero.png} \vspace*{-1cm}

} }





\begin{frame}[fragile,c]{}

\begin{center}
\begin{minipage}[c]{9.3cm}
\begin{semiverbatim}
\lstset{basicstyle=\normalsize}
\begin{lstlisting}[linewidth=9.3cm]
 Karl -- this is very interesting,
 however you used an old version of
 the data (n=143 rather than n=226).

 I'm really sorry you did all that
 work on the incomplete dataset.

 Bruce
\end{lstlisting}
\end{semiverbatim}
\end{minipage}
\end{center}

\end{frame}


\begin{frame}[c]{}
\centering
{\Large The results in Table 1 don't seem to \\[12pt]
correspond to those in Figure 2.}

\end{frame}



\begin{frame}[c]{}
\centerline{\Large Where did we get this data file?}
\end{frame}



\begin{frame}[c]{}
\centerline{\Large Why did I omit those samples?}
\end{frame}



\begin{frame}[c]{}
\centerline{\Large How did I make that figure?}
\end{frame}




\begin{frame}[c]{}


\centering
\Large

Reproducible

\bigskip

{\color{lolit} vs.}

\bigskip

\only<1>{Replicable}
\only<2 | handout 0>{Correct}

\end{frame}



\begin{frame}[c]{Steps toward reproducible research}

  \centering
  \Large

  \href{https://kbroman.org/steps2rr}{\tt \color{foreground} kbroman.org/steps2rr}

\end{frame}


\begin{frame}[c]{1. Organizing data in spreadsheets}

\begin{center}
\large
Organize data for computers
\end{center}

\end{frame}


\begin{frame}{Improve this arrangement?}

\vspace{7mm}

\figh{Figs/spreadsheet_ugly.pdf}{0.6}

\end{frame}




\begin{frame}{Improved arrangement}

\vspace{7mm}

\figh{Figs/spreadsheet_tidy.pdf}{0.6}

\vspace{10mm}

\end{frame}


\begin{frame}{Fill in all cells}

\vspace{7mm}

\figh{Figs/spreadsheet_fill_in_all_cells.pdf}{0.6}

\vspace{10mm}

\end{frame}




\begin{frame}{Make it a rectangle}

\vspace{7mm}

\figh{Figs/spreadsheet_make_rectangle.pdf}{0.6}

\vspace{10mm}

\end{frame}



\begin{frame}{No calculations with the raw data}

\vspace{7mm}

\figh{Figs/spreadsheet_no_calculations.pdf}{0.6}

\vspace{10mm}

\end{frame}




\begin{frame}{Use one header row}

\vspace{7mm}

\figh{Figs/spreadsheet_one_header.pdf}{0.6}

\vspace{10mm}

\end{frame}




\begin{frame}[c]{1. Organizing data in spreadsheets}

  \begin{itemize}
    \footnotesize
  \item Make it a rectangle (rows = observations, cols=variables)
  \item Use a single header row; avoid spaces.
  \item Be consistent.
  \item Use care about dates.
  \item Put just one thing in a cell.
  \item Fill in all cells.
  \item Explicit code for missing values (e.g. {\tt -} or {\tt N/A})
  \item No calculations/graphs in the raw data files.
  \item Don't use font color or highlighting as data.
  \item Make backups.
  \item Use data validation to avoid data entry mistakes.
  \item Save the data in plain text files.
  \end{itemize}


\vspace{7mm}

\hfill
{\footnotesize \lolit
\href{https://doi.org/10.1080/00031305.2017.1375989}{Broman \& Woo,
Am Stat 78:2--10, 2018}
}




\end{frame}





\begin{frame}[c]{2. Organizing projects}

\begin{center}
\large
File organization and naming \\
are powerful weapons against chaos.
\end{center}

\hfill
{\lolit
{\textendash} \href{http://www.stat.ubc.ca/~jenny/}{Jenny Bryan}
}

\end{frame}


\begin{frame}[c]{2. Organizing projects}

\begin{center}
\large
Your closest collaborator is you six months ago, \\
but you don't reply to emails.
\end{center}

\hfill
{\lolit
(paraphrasing \href{https://twitter.com/kcranstn/status/370914072511791104}{Mark Holder})
}

\end{frame}


\begin{frame}[c]{2. Organizing projects}

\begin{center}
\large
Have sympathy for your future self.
\end{center}


\end{frame}




\begin{frame}[c]{How to organize these files?}

\vspace{5mm}

\figw{Figs/activity2b.png}{1.08}

\end{frame}




\begin{frame}<handout:0>[fragile,c]{Be consistent}

\only<1>{\addtocounter{framenumber}{-1}}

\begin{center}
\begin{minipage}[c]{10.3cm}
\begin{semiverbatim}
\lstset{basicstyle=\normalsize}
\begin{lstlisting}[linewidth=10.3cm]
RawData/              Notes/
CleanData/            Refs/

Python/               ReadMe.txt
R/                    ToDo.txt
Ruby/
\end{lstlisting}
\end{semiverbatim}
\end{minipage}
\end{center}

\end{frame}


\begin{frame}<handout:0>[fragile,c]{Chaos}

\addtocounter{framenumber}{-1}

\begin{center}
\begin{minipage}[c]{11.33cm}
\begin{semiverbatim}
\lstset{basicstyle=\scriptsize}
\begin{lstlisting}[linewidth=11.33cm]
AimeeNullSims/    Deuterium/            Ping/
AimeeResults/     ExtractData4Gary/     Ping2/
AnnotationFiles/  FromAimee/            Ping3/
Brian/            GoldStandard/         Ping4/
Chr6_extrageno/   HumanGWAS/            Play/
Chr6_segdis/      Insulin/              Prdm9/
ChrisPlaisier/    Int2_for_Mark/        RBM_PlasmaUrine_2012-03-08/
Code4Aimee/       Islet_2011-05/        Slco1a6/
CompAnnot/        MappingProbes/        StudyLineupMethods/
CondScans/        MultiProbes/          kidney_chr6.R
D2O_2012-02-14/   NewMap/               pck2_sucla2.R
D2O_cellcycle/    Notes/                penalties.txt
D2Ocorr/          NullSims/             transeQTL4Lude/
Data4Aimee/       NullSims_2009-09-10/
Data4Tram/        PepIns_2012-02-09/
\end{lstlisting}
\end{semiverbatim}
\end{minipage}
\end{center}

\end{frame}





\begin{frame}[c]{Naming files}

  \bbi
\item Concise
\item Meaningful
\item No spaces or special characters except underscores and hyphens
\item Dates like 2018-09-05 (or 20180905)
\item Sortable
\item Be consistent
  \ei

\end{frame}



\begin{frame}{Also}

  \bbi
\item Documentation
  \bi
\item Detailed electronic notes
\item Have sympathy for your future self
\item Maintained to match the material
  \ei
\item Meta-data
  \bi
\item Data about the data
\item Yet another spreadsheet
\item Data dictionary: explain variables, abbreviations, units, codes
  \ei
  \ei

\end{frame}



\begin{frame}[c]{3. Everything with a script}

\centering
\large
If you do something once, \\
you'll do it 1000 times.
\end{frame}


\begin{frame}{Advantages of code}

\bbi
\item More transparent
\item Can be automated and repeated
\item Less tedious and error prone (in principle)
\item More flexible
\item Necessary for high-dimensional data
\ei

\end{frame}




\begin{frame}[fragile,c]{4. Automate the process (GNU Make)}

\vspace{15mm}

\begin{center}
\begin{minipage}[c]{10.8cm}
\begin{semiverbatim}
\begin{lstlisting}[escapechar=!,linewidth=10.8cm]
!{\color{foreground}{R/analysis.html}}!: !{\color{foreground}{R/analysis.Rmd Data/cleandata.csv}}!
!{\color{foreground}{    cd R;R -e "rmarkdown::render('analysis.Rmd')"}!

Data/cleandata.csv: R/prepData.R RawData/rawdata.csv
    cd R;R CMD BATCH prepData.R

RawData/rawdata.csv: Python/xls2csv.py RawData/rawdata.xls
    Python/xls2csv.py RawData/rawdata.xls > RawData/rawdata.csv
\end{lstlisting}
\end{semiverbatim}
\end{minipage}
\end{center}

\vspace{15mm}

\hfill
{\footnotesize \lolit
\href{http://kbroman.org/minimal_make}{\tt kbroman.org/minimal\_make}
}


\end{frame}



\begin{frame}<handout:0>[fragile,c]{4. Automate the process (GNU Make)}

\addtocounter{framenumber}{-1}

\vspace{15mm}

\begin{center}
\begin{minipage}[c]{10.8cm}
\begin{semiverbatim}
\begin{lstlisting}[escapechar=!,linewidth=10.8cm]
!{\color{codehilit}{R/analysis.html}}!: !{\color{foreground}{R/analysis.Rmd Data/cleandata.csv}}!
!{\color{foreground}{    cd R;R -e "rmarkdown::render('analysis.Rmd')"}!

Data/cleandata.csv: R/prepData.R RawData/rawdata.csv
    cd R;R CMD BATCH prepData.R

RawData/rawdata.csv: Python/xls2csv.py RawData/rawdata.xls
    Python/xls2csv.py RawData/rawdata.xls > RawData/rawdata.csv
\end{lstlisting}
\end{semiverbatim}
\end{minipage}
\end{center}


\vspace{15mm}

\hfill
{\footnotesize \lolit
\href{http://kbroman.org/minimal_make}{\tt kbroman.org/minimal\_make}
}

\end{frame}



\begin{frame}<handout:0>[fragile,c]{4. Automate the process (GNU Make)}

\addtocounter{framenumber}{-1}

\vspace{15mm}

\begin{center}
\begin{minipage}[c]{10.8cm}
\begin{semiverbatim}
\begin{lstlisting}[escapechar=!,linewidth=10.8cm]
!{\color{foreground}{R/analysis.html}}!: !{\color{codehilit}{R/analysis.Rmd Data/cleandata.csv}}!
!{\color{foreground}{    cd R;R -e "rmarkdown::render('analysis.Rmd')"}!

Data/cleandata.csv: R/prepData.R RawData/rawdata.csv
    cd R;R CMD BATCH prepData.R

RawData/rawdata.csv: Python/xls2csv.py RawData/rawdata.xls
    Python/xls2csv.py RawData/rawdata.xls > RawData/rawdata.csv
\end{lstlisting}
\end{semiverbatim}
\end{minipage}
\end{center}

\vspace{15mm}

\hfill
{\footnotesize \lolit
\href{http://kbroman.org/minimal_make}{\tt kbroman.org/minimal\_make}
}

\end{frame}



\begin{frame}<handout:0>[fragile,c]{4. Automate the process (GNU Make)}

\addtocounter{framenumber}{-1}

\vspace{15mm}

\begin{center}
\begin{minipage}[c]{10.8cm}
\begin{semiverbatim}
\begin{lstlisting}[escapechar=!,linewidth=10.8cm]
!{\color{foreground}{R/analysis.html}}!: !{\color{foreground}{R/analysis.Rmd Data/cleandata.csv}}!
!{\color{codehilit}{    cd R;R -e "rmarkdown::render('analysis.Rmd')"}}!

Data/cleandata.csv: R/prepData.R RawData/rawdata.csv
    cd R;R CMD BATCH prepData.R

RawData/rawdata.csv: Python/xls2csv.py RawData/rawdata.xls
    Python/xls2csv.py RawData/rawdata.xls > RawData/rawdata.csv
\end{lstlisting}
\end{semiverbatim}
\end{minipage}
\end{center}

\vspace{15mm}

\hfill
{\footnotesize \lolit
\href{http://kbroman.org/minimal_make}{\tt kbroman.org/minimal\_make}
}

\end{frame}






\begin{frame}[c]{5. Turn scripts into reproducible reports}


\vspace*{8mm}

\figw{Figs/example_Rmd.png}{0.92}
\onslide<2>{
  \vspace*{-0.45\textheight}
  \hspace*{0.10\textwidth}
  \figw{Figs/example_Rmd_source.png}{0.92}
}

\end{frame}



\begin{frame}[fragile,c]{6. Turn repeated code into functions}

\begin{center}
\begin{minipage}[c]{10.8cm}
\begin{semiverbatim}
\lstset{basicstyle=\large}
\begin{lstlisting}[linewidth=10.8cm]
# Python
def read_genotypes (filename):
    "Read matrix of genotype data"
\end{lstlisting}
\end{semiverbatim}
\end{minipage}
\end{center}

\vspace*{-8mm}

\begin{center}
\begin{minipage}[c]{10.8cm}
\begin{semiverbatim}
\lstset{basicstyle=\large}
\begin{lstlisting}[linewidth=10.8cm]
# R
plot_genotypes <-
function(genotypes, ...)
{
}
\end{lstlisting}
\end{semiverbatim}
\end{minipage}
\end{center}

\end{frame}


\begin{frame}[c]{7. Create a package/module}

\onslide<2>{\vspace{24mm}}

  \centering
  \Large
  Don't repeat yourself

\onslide<2>{
\vspace{30mm}

\hfill
{\footnotesize \lolit
\href{http://kbroman.org/pkg_primer}{\tt kbroman.org/pkg\_primer}
}
}

\end{frame}


\begin{frame}<handout:0>[c]{8. Use version control (git/GitHub)}

\vspace*{3mm}

\centering

% comic from http://www.phdcomics.com/comics/archive.php?comicid=1531
\only<1>{\figh{Figs/phd101212s.png}{0.8}}

\end{frame}


\begin{frame}<handout:0>[fragile,c]{No ``{\hilit final}'' in file names}


\addtocounter{framenumber}{-1}

\begin{center}
\begin{minipage}[c]{9.5cm}
\begin{semiverbatim}
\lstset{basicstyle=\tiny}
\begin{lstlisting}[escapechar=!,linewidth=9.5cm]
!{\color{foreground}{Deprecated/                            hypo_prcomp.RData}!
!{\color{foreground}{ReadMe.txt                             islet_int1_final.RData}!
!{\color{foreground}{adipose_int1_final.RData               islet_int2_final.RData}!
!{\color{foreground}{adipose_int2_final.RData               islet_mlratio_final.RData}!
!{\color{foreground}{adipose_mlratio_final.RData            islet_mlratio_nqrank_final.RData}!
!{\color{foreground}{adipose_mlratio_nqrank_final.RData     islet_prcomp.RData}!
!{\color{foreground}{adipose_prcomp.RData                   kidney_int1_final.RData}!
!{\color{foreground}{aligned_geno_with_pmap.RData           kidney_int2_final.RData}!
!{\color{foreground}{batches_final.RData                    kidney_mlratio_final.RData}!
!{\color{foreground}{batches_raw_final.RData                kidney_mlratio_nqrank_final.RData}!
!{\color{foreground}{cpl_final.RData                        kidney_prcomp.RData}!
!{\color{foreground}{d2o_final.RData                        lipomics_final_rev2.RData}!
!{\color{foreground}{gastroc_int1_final.RData               liverTG_final.RData}!
!{\color{foreground}{gastroc_int2_final.RData               liver_int1_final.RData}!
!{\color{foreground}{gastroc_mlratio_final.RData            liver_int2_final.RData}!
!{\color{foreground}{gastroc_mlratio_nqrank_final.RData     liver_mlratio_final.RData}!
!{\color{foreground}{gastroc_prcomp.RData                   liver_mlratio_nqrank_final.RData}!
!{\color{foreground}{hypo_int1_final.RData                  liver_prcomp.RData}!
!{\color{foreground}{hypo_int2_final.RData                  mirna_final.RData}!
!{\color{foreground}{hypo_mlratio_final.RData               necropsy_final_rev2.RData}!
!{\color{foreground}{hypo_mlratio_final_old.RData           plasmaurine_final_rev.RData}!
!{\color{foreground}{hypo_mlratio_nqrank_final.RData        pmark.RData}!
!{\color{foreground}{hypo_mlratio_nqrank_final_old.RData    rbm_final.RData}!
!{\color{foreground}{hypo_omit.RData}!
\end{lstlisting}
\end{semiverbatim}
\end{minipage}
\end{center}


\end{frame}


\begin{frame}<handout:0>[fragile,c]{No ``{\hilit final}'' in file names}


\addtocounter{framenumber}{-1}

\begin{center}
\begin{minipage}[c]{9.5cm}
\begin{semiverbatim}
\lstset{basicstyle=\tiny}
\begin{lstlisting}[escapechar=!,linewidth=9.5cm]
!{\color{foreground}{Deprecated/                            hypo_prcomp.RData}!
!{\color{foreground}{ReadMe.txt                             islet_int1_final.RData}!
!{\color{foreground}{adipose_int1_final.RData               islet_int2_final.RData}!
!{\color{foreground}{adipose_int2_final.RData               islet_mlratio_final.RData}!
!{\color{foreground}{adipose_mlratio_final.RData            islet_mlratio_nqrank_final.RData}!
!{\color{foreground}{adipose_mlratio_nqrank_final.RData     islet_prcomp.RData}!
!{\color{foreground}{adipose_prcomp.RData                   kidney_int1_final.RData}!
!{\color{foreground}{aligned_geno_with_pmap.RData           kidney_int2_final.RData}!
!{\color{foreground}{batches_final.RData                    kidney_mlratio_final.RData}!
!{\color{foreground}{batches_raw_final.RData                kidney_mlratio_nqrank_final.RData}!
!{\color{foreground}{cpl_final.RData                        kidney_prcomp.RData}!
!{\color{foreground}{d2o_final.RData                       }!!{\color{vhilit} lipomics_final_rev2.RData}!
!{\color{foreground}{gastroc_int1_final.RData               liverTG_final.RData}!
!{\color{foreground}{gastroc_int2_final.RData               liver_int1_final.RData}!
!{\color{foreground}{gastroc_mlratio_final.RData            liver_int2_final.RData}!
!{\color{foreground}{gastroc_mlratio_nqrank_final.RData     liver_mlratio_final.RData}!
!{\color{foreground}{gastroc_prcomp.RData                   liver_mlratio_nqrank_final.RData}!
!{\color{foreground}{hypo_int1_final.RData                  liver_prcomp.RData}!
!{\color{foreground}{hypo_int2_final.RData                  mirna_final.RData}!
!{\color{foreground}{hypo_mlratio_final.RData              }!!{\color{vhilit} necropsy_final_rev2.RData}!
!{\color{vhilit}{hypo_mlratio_final_old.RData           plasmaurine_final_rev.RData}!
!{\color{foreground}{hypo_mlratio_nqrank_final.RData        pmark.RData}!
!{\color{vhilit}{hypo_mlratio_nqrank_final_old.RData   }!!{\color{foreground} rbm_final.RData}!
!{\color{foreground}{hypo_omit.RData}!
\end{lstlisting}
\end{semiverbatim}
\end{minipage}
\end{center}


\end{frame}



\begin{frame}[c]{8. Use version control (git/GitHub)}

\only<1>{\addtocounter{framenumber}{-1}}

\vspace*{3mm}

\centering

\figh{Figs/example_commit}{0.80}

\hfill
{\footnotesize \lolit
\href{http://kbroman.org/github_tutorial}{\tt kbroman.org/github\_tutorial}
}

\end{frame}



\begin{frame}{9. License your software}

\vspace{60pt}

\centerline{\large Pick a license, any license}

\vspace{18pt}

\hfill
{\textendash} \href{http://blog.codinghorror.com/pick-a-license-any-license/}{Jeff Atwood}

\end{frame}



\begin{frame}[c]{Summary}

\small
    \begin{enumerate}
    \item Arrange data to ease analysis
    \item Organize your data and code
    \item Everything with a script
    \item Automate the process
    \item Turn scripts into reproducible reports
    \item Turn repeated code into functions
    \item Create a package/module
    \item Use version control
    \item License your software
    \end{enumerate}

\end{frame}




\begin{frame}[c]{}

\begin{center}
\large
The most important tool is the {\hilit mindset},\\
when starting, that the end product \\
will be reproducible.
\end{center}

\hfill
{\lolit
{\textendash} \href{http://odin.mdacc.tmc.edu/~kabaggerly/}{Keith Baggerly}
}

\end{frame}



\begin{frame}[c]{}

\Large

Slides: \href{https://bit.ly/steps2rr}{\tt bit.ly/steps2rr} \quad
\includegraphics[height=5mm]{Figs/cc-zero.png}

\vspace{10mm}

\href{https://kbroman.org}{\tt kbroman.org}

\vspace{10mm}

\href{https://twitter.com/kwbroman}{\tt @kwbroman}


\end{frame}




\end{document}
